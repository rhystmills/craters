import math
import svgwrite
from miditime.miditime import MIDITime
mymidi = MIDITime(120, 'myfile.mid', 5, 5, 1)

my_data = [
    {'event_date': 1, 'magnitude': 3.4},
    {'event_date': 2, 'magnitude': 3.2},
    {'event_date': 3, 'magnitude': 3.6},
    {'event_date': 4, 'magnitude': 3.0},
    {'event_date': 5, 'magnitude': 5.6},
    {'event_date': 6, 'magnitude': 4.0}
]

exampleData = { 'x': 21, 'y': 15, 'r': 5}



craterDater = [
    { 'x': 21, 'y': 351, 'r': 9.706684619910241 },
    { 'x': 27, 'y': 220, 'r': 10.217907939900583 },
    { 'x': 31, 'y': 283, 'r': 10.764051215546116 },
    { 'x': 34, 'y': 121, 'r': 9.706684619910241 },
    { 'x': 39, 'y': 182, 'r': 11.227230955528665 },
    { 'x': 41, 'y': 436, 'r': 10.02925341359355 },
    { 'x': 41, 'y': 538, 'r': 10.092530088080641 },
    { 'x': 43, 'y': 304, 'r': 8.95623198216277 },
    { 'x': 57, 'y': 525, 'r': 9.83698151873187 },
    { 'x': 63, 'y': 202, 'r': 10.524820207108489 },
    { 'x': 69, 'y': 305, 'r': 9.640875829802336 },
    { 'x': 70, 'y': 78, 'r': 10.092530088080641 },
    { 'x': 80, 'y': 142, 'r': 9.23618154310838 },
    { 'x': 82, 'y': 229, 'r': 9.373021315815206 },
    { 'x': 100, 'y': 255, 'r': 9.965574970333758 },
    { 'x': 102, 'y': 324, 'r': 10.155412503859614 },
    { 'x': 117, 'y': 32, 'r': 8.95623198216277 },
    { 'x': 119, 'y': 226, 'r': 13.58748446131949 },
    { 'x': 124, 'y': 211, 'r': 8.593479713983122 },
    { 'x': 126, 'y': 455, 'r': 11.834540545406394 },
    { 'x': 129, 'y': 279, 'r': 9.640875829802336 },
    { 'x': 132, 'y': 14, 'r': 7.898654169668588 },
    { 'x': 131, 'y': 234, 'r': 7.569397566060481 },
    { 'x': 138, 'y': 352, 'r': 14.406180819073164 },
    { 'x': 138, 'y': 249, 'r': 8.95623198216277 },
    { 'x': 142, 'y': 516, 'r': 9.23618154310838 },
    { 'x': 143, 'y': 465, 'r': 9.83698151873187 },
    { 'x': 146, 'y': 404, 'r': 11.227230955528665 },
    { 'x': 145, 'y': 27, 'r': 7.735777827895049 },
    { 'x': 155, 'y': 111, 'r': 10.217907939900583 },
    { 'x': 156, 'y': 72, 'r': 10.02925341359355 },
    { 'x': 156, 'y': 364, 'r': 8.95623198216277 },
    { 'x': 158, 'y': 25, 'r': 6.770275002573076 },
    { 'x': 174, 'y': 83, 'r': 11.941642642883693 },
    { 'x': 172, 'y': 398, 'r': 8.884866446580956 },
    { 'x': 173, 'y': 349, 'r': 10.217907939900583 },
    { 'x': 175, 'y': 48, 'r': 7.569397566060481 },
    { 'x': 177, 'y': 240, 'r': 7.046725639945928 },
    { 'x': 179, 'y': 426, 'r': 11.834540545406394 },
    { 'x': 181, 'y': 136, 'r': 9.507891862878783 },
    { 'x': 182, 'y': 283, 'r': 9.373021315815206 },
    { 'x': 191, 'y': 458, 'r': 9.83698151873187 },
    { 'x': 193, 'y': 254, 'r': 10.524820207108489 },
    { 'x': 194, 'y': 194, 'r': 10.217907939900583 },
    { 'x': 206, 'y': 422, 'r': 13.159049284959082 },
    { 'x': 207, 'y': 120, 'r': 8.95623198216277 },
    { 'x': 207, 'y': 369, 'r': 9.304852983362556 },
    { 'x': 208, 'y': 554, 'r': 12.309163489997376 },
    { 'x': 215, 'y': 202, 'r': 8.136857890256438 },
    { 'x': 219, 'y': 320, 'r': 10.940041919714261 },
    { 'x': 220, 'y': 108, 'r': 5.970821321441846 },
    { 'x': 224, 'y': 478, 'r': 11.726460285670077 },
    { 'x': 229, 'y': 129, 'r': 8.214724333230155 },
    { 'x': 231, 'y': 347, 'r': 10.092530088080641 },
    { 'x': 232, 'y': 63, 'r': 9.440697438826296 },
    { 'x': 232, 'y': 196, 'r': 9.640875829802336 },
    { 'x': 239, 'y': 215, 'r': 15.09668435477122 },
    { 'x': 238, 'y': 39, 'r': 9.166995688475081 },
    { 'x': 245, 'y': 181, 'r': 8.95623198216277 },
    { 'x': 246, 'y': 480, 'r': 10.823032759612019 },
    { 'x': 247, 'y': 25, 'r': 4.918490759365935 },
    { 'x': 253, 'y': 433, 'r': 12.6156626101008 },
    { 'x': 267, 'y': 240, 'r': 9.0270333367641 },
    { 'x': 271, 'y': 481, 'r': 9.574614729634384 },
    { 'x': 276, 'y': 69, 'r': 18.403307281560924 },
    { 'x': 273, 'y': 423, 'r': 11.834540545406394 },
    { 'x': 275, 'y': 398, 'r': 10.645107772184812 },
    { 'x': 286, 'y': 14, 'r': 8.740387444736633 },
    { 'x': 289, 'y': 187, 'r': 12.815923738491737 },
    { 'x': 296, 'y': 356, 'r': 10.998079684646791 },
    { 'x': 296, 'y': 544, 'r': 10.092530088080641 },
    { 'x': 299, 'y': 80, 'r': 10.092530088080641 },
    { 'x': 302, 'y': 429, 'r': 10.764051215546116 },
    { 'x': 307, 'y': 272, 'r': 7.653039857325812 },
    { 'x': 311, 'y': 16, 'r': 8.136857890256438 },
    { 'x': 317, 'y': 559, 'r': 8.812923024107548 },
    { 'x': 321, 'y': 193, 'r': 9.09728368293446 },
    { 'x': 322, 'y': 217, 'r': 8.812923024107548 },
    { 'x': 323, 'y': 536, 'r': 9.166995688475081 },
    { 'x': 325, 'y': 126, 'r': 9.640875829802336 },
    { 'x': 327, 'y': 417, 'r': 10.02925341359355 },
    { 'x': 330, 'y': 323, 'r': 8.291859587312052 },
    { 'x': 332, 'y': 518, 'r': 13.911592676604096 },
    { 'x': 332, 'y': 58, 'r': 10.092530088080641 },
    { 'x': 348, 'y': 114, 'r': 8.95623198216277 },
    { 'x': 353, 'y': 162, 'r': 8.95623198216277 },
    { 'x': 354, 'y': 245, 'r': 10.280023453913834 },
    { 'x': 354, 'y': 277, 'r': 9.304852983362556 },
    { 'x': 359, 'y': 72, 'r': 10.217907939900583 },
    { 'x': 360, 'y': 454, 'r': 10.645107772184812 },
    { 'x': 366, 'y': 523, 'r': 9.09728368293446 },
    { 'x': 370, 'y': 237, 'r': 9.507891862878783 },
    { 'x': 371, 'y': 498, 'r': 11.227230955528665 },
    { 'x': 380, 'y': 165, 'r': 9.0270333367641 },
    { 'x': 380, 'y': 475, 'r': 9.373021315815206 },
    { 'x': 383, 'y': 287, 'r': 9.507891862878783 },
    { 'x': 384, 'y': 101, 'r': 10.940041919714261 },
    { 'x': 389, 'y': 48, 'r': 8.740387444736633 },
    { 'x': 391, 'y': 332, 'r': 9.440697438826296 },
    { 'x': 394, 'y': 234, 'r': 9.965574970333758 },
    { 'x': 402, 'y': 210, 'r': 8.593479713983122 },
    { 'x': 409, 'y': 302, 'r': 11.507254783503184 },
    { 'x': 413, 'y': 231, 'r': 9.166995688475081 },
    { 'x': 413, 'y': 132, 'r': 7.569397566060481 },
    { 'x': 419, 'y': 326, 'r': 9.507891862878783 },
    { 'x': 419, 'y': 559, 'r': 9.166995688475081 },
    { 'x': 432, 'y': 272, 'r': 9.304852983362556 }
]

dwg = svgwrite.Drawing('test.svg', size=(500, 500), profile='tiny')
for row in craterDater:
    dwg.add(dwg.circle((row['x'], row['y']), row['r']))
dwg.save()

my_data_epoched = [{'days_since_epoch': d['event_date'], 'magnitude': d['magnitude']} for d in my_data]

my_data_timed = [{'beat': mymidi.beat(d['days_since_epoch']), 'magnitude': d['magnitude']} for d in my_data_epoched]

start_time = craterDater[0]['x']

def mag_to_pitch_tuned(magnitude):
    # Where does this data point sit in the domain of your data? (I.E. the min magnitude is 3, the max in 5.6). In this case the optional 'True' means the scale is reversed, so the highest value will return the lowest percentage.
    scale_pct = mymidi.linear_scale_pct(0, 600, magnitude)

    # Another option: Linear scale, reverse order
    # scale_pct = mymidi.linear_scale_pct(3, 5.7, magnitude, True)

    # Another option: Logarithmic scale, reverse order
    # scale_pct = mymidi.log_scale_pct(3, 5.7, magnitude, True)

    # Pick a range of notes. This allows you to play in a key.
    c_major = ['C', 'D', 'E', 'F', 'G', 'A', 'B']

    #Find the note that matches your data point
    note = mymidi.scale_to_note(scale_pct, c_major)

    #Translate that note to a MIDI pitch
    midi_pitch = mymidi.note_to_midi_pitch(note)

    return midi_pitch

note_list = []

for d in craterDater:
    note_list.append([
        d['x'] - start_time,
        mag_to_pitch_tuned(d['y']),
        math.floor((d['r'] / 19) * 127),  # velocity
        1  # duration, in beats
    ])

# Add a track with those notes
mymidi.add_track(note_list)

# Output the .mid file
mymidi.save_midi()
